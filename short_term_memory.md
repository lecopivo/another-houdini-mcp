## Short-Term Memory

- 2026-02-13: Added SOP study note for `vellumconstraints` after live hair-pin debugging session.
- Docs reviewed:
  - `help/nodes/sop/vellumconstraints.txt`
- Example coverage:
  - No local `help/examples/nodes/sop/vellumconstraints/` folder in corpus.
  - Used fallback companion coverage from `sop/vellumsolver` examples + custom live setups.
- Key observed outcomes:
  - Separate staged constraints (`hair` then `pin`) are clearer and easier to debug.
  - Empty/wrong-class groups can silently disable constraints and mimic solver instability.
  - Validating group non-emptiness before solve is a high-value check.
- Docs updated:
  - Added `memory/nodes/sop/vellumconstraints.md`
  - Added `memory/nodes/sop/sphere.md`
  - Updated `memory/nodes/sop/group.md` (non-empty group gotcha)
  - Updated `memory/nodes/sop_progress.md` and `memory/houdiin_ai_acedemy_progress.md`

- 2026-02-13: Studied `sop/vellumsolver` with full local example sweep and heavy-solver hygiene.
- Docs reviewed:
  - `help/nodes/sop/vellumsolver.txt`
  - `help/examples/nodes/sop/vellumsolver/*.txt` (18 examples)
- Example handling policy followed for compute-heavy content:
  - Loaded exactly one example at a time, inspected, then deleted it before loading the next.
- Examples loaded/inspected (all deleted after inspection):
  - `AnimatedConstraints`, `AnimatedPressure`, `ArmLayer`, `ArmTarget`, `CollisionDisable`, `CollisionIgnore`, `DynamicAttach`, `DynamicStitchGlue`, `GluedGrains`, `HairOrient`, `ResolutionTarget`, `SimpleWeld`, `StiffnessDropoff`, `TetrahedralFiber`, `VaryingFriction`, `VellumFluidPhasesStart`, `VellumFluidPhasesReference`, `VellumFluidSetupGeo`.
- Key observed outcomes:
  - Dynamic constraint creation/update pattern repeatedly appears inside `vellumsolver/dopnet/forces`.
  - Collision control examples confirm practical use of `collisionignore`, `collisiongroup`, and `disableexternal` attrs.
  - Layering (`layer` + `layershock`) and multi-res targeting are strong reusable workflows.
  - Fluid phase example confirms DOP-side Vellum Source pattern; direct solver output may be empty at start frame while display merge contains collider/scene geometry.
- Docs updated:
  - Added `memory/nodes/sop/vellumsolver.md`
  - Updated `memory/nodes/sop_progress.md` (25 studied SOP nodes; example sets reviewed 44)
  - Updated `memory/houdiin_ai_acedemy_progress.md` (overall studied/notes 25; SOP 10.6%)
  - Updated `memory/sop_context.md` (added Vellum Solver pattern section)

- 2026-02-13: Finished all previously in-progress SOP notes using fallback coverage for nodes with missing local example folders.
- Completed nodes promoted to studied:
  - `copytopoints`, `boolean`, `switch`, `switchif`, `voronoifracture`, `name`, `groupsfromname`, `error`
- Companion examples additionally reviewed for completion evidence:
  - `help/examples/nodes/sop/copy/StampRandom.*` (switch in production context)
  - `help/examples/nodes/sop/foreach/cheese.*` (looped boolean/cookie context)
  - `help/examples/nodes/sop/surfsect/SurfsectBasic.*` (boolean-style surfsect companion)
- Additional observations recorded:
  - `switch1` in StampRandom is expression-driven from copy stamping.
  - `foreach/cheese` demonstrates boolean logic as companion `cookie` within iterative workflow.
- Progress updates:
  - `memory/nodes/sop_progress.md` now marks 24/24 visited SOP notes as studied.
  - `memory/houdiin_ai_acedemy_progress.md` SOP progress updated to 10.2%.
  - `memory/sop_context.md` updated with missing-example fallback strategy and switch/boolean companion patterns.

- 2026-02-13: Studied/tested SOP nodes `voronoifracture`, `scatter`, `name`, `groupsfromname`, `error`.
- Docs reviewed:
  - `help/nodes/sop/voronoifracture.txt`
  - `help/nodes/sop/scatter.txt`
  - `help/nodes/sop/name.txt`
  - `help/nodes/sop/groupsfromname.txt`
  - `help/nodes/sop/error.txt`
- Examples loaded and inspected:
  - `/obj/academy_SpikyDeformingTorus` and `/obj/academy_DoorWithPolkaDots` from `help/examples/nodes/sop/scatter/*`
  - companion voronoi workflow in `/obj/academy_PackedFragments/sphere`
- Additional live validation network:
  - `/obj/academy_name_groups_error` for `name`/`groupsfromname`/`error` behavior.
- Key observed outcomes:
  - Scatter: stable-point workflows validated via `primnum`/`primuvw` and texture-space mode.
  - Voronoi fracture companion test: increasing scatter seeds `20 -> 40` increased packed pieces `20 -> 40` downstream.
  - Name/GroupsFromName: confirmed `name` values (`part0`, `part1`) and regenerated prefixed groups (`nm_part0`, `nm_part1`).
  - Error: warning severity passes geometry while reporting warning; error severity blocks downstream cook.
- Companion-node updates made in same session:
  - Updated `memory/nodes/sop/assemble.md` (seed-count scaling finding)
  - Updated `memory/nodes/sop/connectivity.md` and `memory/nodes/sop/partition.md` (bridge-pattern findings)
- Docs updated:
  - Added `memory/nodes/sop/voronoifracture.md`
  - Added `memory/nodes/sop/scatter.md`
  - Added `memory/nodes/sop/name.md`
  - Added `memory/nodes/sop/groupsfromname.md`
  - Added `memory/nodes/sop/error.md`
  - Updated `memory/nodes/sop_progress.md`
  - Updated `memory/houdiin_ai_acedemy_progress.md`
  - Updated `memory/sop_context.md`

- 2026-02-13: Studied/tested SOP nodes `switchif`, `attribpromote`, `connectivity`, `partition`, `assemble`.
- Docs reviewed:
  - `help/nodes/sop/switchif.txt`
  - `help/nodes/sop/attribpromote.txt`
  - `help/nodes/sop/connectivity.txt`
  - `help/nodes/sop/partition.txt`
  - `help/nodes/sop/assemble.txt`
- Examples loaded and inspected:
  - `/obj/academy_AttribPromoteSphere` from `help/examples/nodes/sop/attribpromote/AttribPromoteSphere.*`
  - `/obj/academy_ConnectedBalls` from `help/examples/nodes/sop/connectivity/ConnectedBalls.*`
  - `/obj/academy_PartitionBall` from `help/examples/nodes/sop/partition/PartitionBall.*`
  - `/obj/academy_PackedFragments` from `help/examples/nodes/sop/assemble/PackedFragments.*`
- Additional live validation network:
  - `/obj/academy_switchif` (no local official `sop/switchif` example folder)
- Key observed outcomes:
  - Switch-If: element-count test on second input cleanly routes fallback/default branch.
  - AttribPromote: confirmed point `foo` -> primitive `foo` promotion and primitive `Cd` -> point `Cd` demotion.
  - Connectivity: examples use primitive connectivity ids (`ball`/`piece`) as downstream control channels.
  - Partition: example demonstrates connectivity->partition group naming flow for DOP object splitting.
  - Assemble: fracture output packed into 20 packed pieces with name/path metadata for RBD pipeline.
- Companion-node findings captured:
  - Strong companion usage documented for `scatter`, `voronoifracture`, and DOP handoff patterns in assemble/partition examples.
- Docs updated:
  - Added `memory/nodes/sop/switchif.md`
  - Added `memory/nodes/sop/attribpromote.md`
  - Added `memory/nodes/sop/connectivity.md`
  - Added `memory/nodes/sop/partition.md`
  - Added `memory/nodes/sop/assemble.md`
  - Updated `memory/nodes/sop_progress.md`
  - Updated `memory/houdiin_ai_acedemy_progress.md`
  - Updated `memory/sop_context.md`

- 2026-02-13: Studied/tested SOP nodes `fuse`, `group`, `switch`, `polyreduce`, `measure`.
- Docs reviewed:
  - `help/nodes/sop/fuse.txt`
  - `help/nodes/sop/group.txt`
  - `help/nodes/sop/switch.txt`
  - `help/nodes/sop/polyreduce.txt`
  - `help/nodes/sop/measure.txt`
- Examples loaded and inspected:
  - `/obj/academy_FuseHood` from `help/examples/nodes/sop/fuse/FuseHood.*`
  - `/obj/academy_FeaturedEdges` from `help/examples/nodes/sop/group/FeaturedEdges.*`
  - `/obj/academy_PolyreduceBatwing` from `help/examples/nodes/sop/polyreduce/PolyreduceBatwing.*`
  - `/obj/academy_MeasureArea` from `help/examples/nodes/sop/measure/MeasureArea.*`
  - `/obj/academy_MeasureLaplacian` from `help/examples/nodes/sop/measure/MeasureLaplacian.*`
- Additional live validation network:
  - `/obj/academy_switch` (no local official `sop/switch` example folder)
- Key observed outcomes:
  - Fuse: `merge_all` `40 pts` -> `fuse1` `29 pts` with consolidation on; returns to `40 pts` when off.
  - Group + PolyReduce: edge group (`entity=2`) drives crease-preserving reduction; `60% -> 30%` reduces sphere output `432 -> 216` prims.
  - PolyReduce batwing baseline: `30720 -> 3072` prims at `percentage=10`; direct edits blocked on locked example instance.
  - Measure: `measure1` writes `area` attr; switching to perimeter with `attribname=perim_test` writes the new prim attr as expected.
  - Switch: selector routes branches; out-of-range indices clamp to valid range in this build (`-1 -> 0`, `3 -> last input`).
- Docs updated:
  - Added `memory/nodes/sop/fuse.md`
  - Added `memory/nodes/sop/group.md`
  - Added `memory/nodes/sop/switch.md`
  - Added `memory/nodes/sop/polyreduce.md`
  - Added `memory/nodes/sop/measure.md`
  - Updated `memory/nodes/sop_progress.md`
  - Updated `memory/houdiin_ai_acedemy_progress.md`
  - Updated `memory/sop_context.md`

- 2026-02-13: Studied/tested SOP nodes `blast`, `merge`, and `remesh`.
- Docs reviewed:
  - `help/nodes/sop/blast.txt`
  - `help/nodes/sop/merge.txt`
  - `help/nodes/sop/remesh.txt`
- Examples loaded and inspected:
  - `/obj/academy_TorusBlast` from `help/examples/nodes/sop/blast/TorusBlast.*`
  - `/obj/academy_MergeAttributes` from `help/examples/nodes/sop/merge/MergeAttributes.*`
  - `/obj/academy_Squidremesh` from `help/examples/nodes/sop/remesh/Squidremesh.*`
- Additional live validation network:
  - `/obj/academy_merge_live` to test merge attribute propagation behavior explicitly.
- Key observed outcomes:
  - Blast: base deletion reduced torus from `100/100` to `93/91` (pts/prims); `negate=1` isolates to `7/3`.
  - Merge: output carries unioned attributes; in custom repro, missing `Cd` defaults appeared as white `(1,1,1)` rather than zero.
  - Remesh: adaptive example output `36417 pts / 72724 prims`; uniform mode and larger `targetsize` reduce topology substantially.
- Docs updated:
  - Added `memory/nodes/sop/blast.md`
  - Added `memory/nodes/sop/merge.md`
  - Added `memory/nodes/sop/remesh.md`
  - Updated `memory/nodes/sop_progress.md`
  - Updated `memory/houdiin_ai_acedemy_progress.md`
  - Updated `memory/sop_context.md`

- 2026-02-13: Continued Houdini AI Academy SOP study batch (copytopoints, foreach, boolean).
- Reviewed docs:
  - `help/nodes/sop/copytopoints.txt`
  - `help/nodes/sop/block_begin.txt`
  - `help/nodes/sop/block_end.txt`
  - `help/nodes/sop/boolean.txt`
- Reviewed examples/assets:
  - `help/examples/nodes/sop/foreach/AttributeShuffle.*`
  - `help/examples/nodes/sop/foreach/ForEachExamples.*`
  - related copy template example: `help/examples/nodes/sop/copy/CopyTemplateAttribs.*`
- Built/loaded live test networks:
  - `/obj/academy_copytopoints`
  - `/obj/academy_boolean`
  - `/obj/academy_AttributeShuffle`
  - `/obj/academy_ForEachExamples`
  - `/obj/academy_CopyTemplateAttribs`
- Key observed outcomes:
  - `copytopoints`: unpacked output scales to `800 pts / 600 prims`; `pack=1` collapses to `100 pts / 100 prims`.
  - `foreach` (block-based AttributeShuffle): validated piece-loop pattern; sticky notes confirm merge-ordering caveat.
  - `boolean::2.0`: validated union/intersect/subtract behavior with bbox deltas.
  - Local docs corpus has no node-scoped `help/examples/nodes/sop/boolean/` or `.../copytopoints/` folders; marked those notes as in-progress/partial where appropriate.
- Notes/progress updates:
  - Added `memory/nodes/sop/copytopoints.md`
  - Added `memory/nodes/sop/foreach.md`
  - Added `memory/nodes/sop/boolean.md`
  - Updated `memory/nodes/sop_progress.md`
  - Updated `memory/houdiin_ai_acedemy_progress.md`
  - Updated `memory/sop_context.md`

- 2026-02-13: Added reusable example-study tool modules to reduce ad-hoc Python usage.
- New tools added under `tool_modules/` and registered in `tool_modules/registry.py`:
  - `install_hda_file`: install `.otl/.hda` files with optional reload behavior.
  - `list_example_nodes`: enumerate example docs/assets under `help/examples/nodes/<context>/`.
  - `instantiate_example_asset`: install an example asset file and create an instance.
  - `load_example`: resolve official example by `context/node/example_name`, install, and instantiate.
  - `get_node_presentation`: inspect node presentation state (display/render/template/bypass/comment).
- Updated `AGENTS.md` tool list + architecture guidance to reflect module-based tool registration.
- Restart checkpoint:
  - Reload/restart Houdini MCP plugin so newly added tool modules are available to command dispatch.

- 2026-02-13: Fixed live MCP regressions in shared geometry stats + default-write validation.
- Updated `tool_modules/hda_utils.py`:
  - `geometry_stats` now computes vertex count using `Geometry.vertexCount()` when available, with fallback to `vertices()` and intrinsic `vertexcount`.
  - This fixes live failures in both `probe_geometry` and `validate_hda_behavior` on Houdini builds where `Geometry.vertices()` is unavailable.
- Updated `tool_modules/set_hda_parm_default.py`:
  - Added post-write verification to confirm template defaults actually persist after `setParmTemplateGroup`.
  - Tool now raises a clear error when defaults cannot be changed (for example non-editable built-in parms on object-level HDAs) instead of returning false success.
- Live verification on connected Houdini:
  - `probe_geometry(/obj/academy_polyextrude/output1)` now succeeds (points/prims/vertices returned).
  - `validate_hda_behavior` on `/obj/mcp_verify1` with JSON-string args now succeeds (`Valid: True`, `Errors: 0`).
  - `set_hda_parm_default(node_path=/obj/mcp_verify1, param_name=t, default_value=\"1.25\")` now correctly fails with explicit non-persisted-default error.
  - `set_hda_parm_default` still succeeds on editable custom HDA parms (validated on `tskrivan::primitive_generator_sop::1.0` `sphere_radius`, then restored to `1.0`).
- Restart checkpoint:
  - If a stale plugin process is running, reload or restart the Houdini MCP plugin so modules importing `geometry_stats` pick up the latest helper implementation.

- 2026-02-12: Patched refactored tool regressions after validation pass.
- Updated `tool_modules/get_node_info.py` to handle template-flag queries safely on OBJ nodes (fallback to `isGenericFlagSet`).
- Updated `tool_modules/validate_hda_behavior.py` to:
  - accept JSON-string or list inputs for `cases`, `comparisons`, and `require_point_attributes`,
  - resolve geometry from SOP nodes or OBJ display/render SOPs before probing.
- Updated `tool_modules/set_hda_parm_default.py` to:
  - coerce string defaults (`"1.25"`, `"true"`, JSON arrays) into correct value types,
  - coerce per-parameter-type tuple values (float/int/string),
  - use `server._resolve_hda_definition` explicitly.
- Restart checkpoint: rerun failing repros:
  - `get_node_info` on `/obj/mcp_verify1` should no longer throw.
  - `set_hda_parm_default` with scalar string should succeed.
  - `validate_hda_behavior` on object-level HDA should resolve geometry and run.
- 2026-02-12 verification run completed:
  - `get_node_info(/obj/mcp_verify1)` succeeded (no template-flag exception).
  - Created object-level verification HDA: `mcp::verify_asset::1.0` at `otls/mcp_verify_asset.hda`.
  - `set_hda_parm_default(node_path=/obj/mcp_verify1, param_name=t, default_value=\"1.25\")` succeeded.
  - `validate_hda_behavior` on `/obj/mcp_verify1` with JSON-string `cases`/`comparisons`/`require_point_attributes` succeeded (`Valid: True`, `Errors: 0`).
- Next checkpoint: optionally run broader regression tests for tool-module bridge paths and add automated tests for these three regressions.
- 2026-02-12: Began Houdini AI Academy training on `sop/lattice`.
  - Reviewed `memory/index.md`, `memory/houdini_ai_academy.md`, and `memory/sop_context.md`.
  - Read official docs in `help/nodes/sop/lattice.txt` and reviewed example notes in `help/examples/nodes/sop/lattice/*.txt`.
  - Built practical test network at `/obj/academy_lattice` with `sphere -> bound -> xform -> lattice -> output`.
  - Verified deformation via bbox delta after cage transform.
  - Inspected example OTL internals by loading and unlocking:
    - `/obj/academy_DeformLattice`
    - `/obj/academy_BallBounce`
    - `/obj/academy_LatticePerChunk`
  - Explicitly extracted and reviewed sticky-note (post-it) text from all three assets and relevant subnets.
  - Extracted reusable patterns for single-lattice and per-piece foreach-lattice workflows.
  - Updated records:
    - `memory/nodes/sop/lattice.md` (now marked studied with OTL findings)
    - `memory/nodes/sop_progress.md` (nodes studied = 1)
    - `memory/houdiin_ai_acedemy_progress.md` (fully studied = 1)
    - `memory/sop_context.md` (context-level lattice pattern notes)
- Next checkpoint: pick next SOP shortlist node (`polyextrude` or `attribwrangle`) and repeat full workflow.
- 2026-02-12: Continued Houdini AI Academy with `sop/polyextrude`.
  - Reviewed:
    - `memory/index.md`
    - `memory/houdini_ai_academy.md`
    - `memory/sop_context.md`
    - `help/nodes/sop/polyextrude.txt` and `help/nodes/sop/polyextrude-.txt`
    - `help/examples/nodes/sop/polyextrude/PolyextrudeTube.txt`
  - Built practical network: `/obj/academy_polyextrude` (`grid -> polyextrude -> output`).
  - Captured observed behavior snapshots via HOM probe script:
    - baseline: points=25 prims=16
    - dist=0.5: points=41 prims=32
    - divs=4: points=89 prims=80
    - outputfront=0: points=80 prims=64
  - Loaded and inspected official example HDA:
    - `/obj/academy_PolyextrudeTube`
    - internals reviewed for `global` and `local` branches
    - node comments extracted; no sticky notes present in this example
  - Updated docs:
    - `memory/nodes/sop/polyextrude.md` (new, marked studied)
    - `memory/nodes/sop_progress.md` (visited/studied counters now 2; example sets 4)
    - `memory/houdiin_ai_acedemy_progress.md` (overall visited/studied/notes now 2; SOP row updated)
    - `memory/sop_context.md` (added PolyExtrude context patterns)
  - Regressions encountered in current working tree while studying:
    - `probe_geometry` fails (`name 'self' is not defined`)
    - `instantiate_hda` fails (`name 'self' is not defined`)
    - `get_sticky_notes` unavailable (`Unknown command`)
  - Next checkpoint: study `attribwrangle` next, or fix the three tool regressions before continuing broader academy runs.
